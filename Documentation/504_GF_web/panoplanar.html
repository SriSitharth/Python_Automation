<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>	
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=8"/>
	<title>PointCab-Layout-Panorama</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">		
	<link rel="stylesheet" href="js/leaflet.css" />
	<script src="js/leaflet.js"></script>
	<link href='js/leaflet.fullscreen.css' rel='stylesheet' />
	<script src='js/Leaflet.fullscreen.min.js'></script>
	<link href='js/L.Control.MousePosition.css' rel='stylesheet' />
	<script src='js/L.Control.MousePosition.js'></script>
	<style type="text/css">
	<!--
	body {
		background-color: #000000;
		padding: 0px;
		margin: 0px;
		border: 0px;
	}
	.smallmap {
		width:99.9%;
		height:99.9%;
		min-height: 250px;		
		background-color: #000000;
		position: absolute;
		padding:0px;
		border: 0px solid #999999;
	}
	-->
	</style>
</head>

<script>

function initialize() {
	
	var pano_rows = ???PointCab_mapRows???;
	var pano_cols = ???PointCab_mapCols???;
	var pano_maxZoom = ???PointCab_mapLevels???;

	var customCRS = L.extend(L.CRS.Simple, {
		    projection: L.extend( L.Projection.LonLat, {
		        bounds: L.bounds([0, 0], [pano_cols, pano_rows])
		    }),
		    transformation: new L.Transformation(1, 0, 1, 0),
		    scale: function (zoom) {
		        return Math.pow(2, zoom - pano_maxZoom);
		    },
		    infinite: false
		});

	// init the tile map
	var map = L.map('panomap', {
		//worldCopyJump: false,		
		continuousWorld: true,
		noWrap: true,
		reuseTiles: true,						
		crs: customCRS, // pixel coordinates
		fullscreenControl: true, // fullscreen plug-in
		});	
			
	
	var layer = L.tileLayer('./???PointCab_map???/{z}/{x}/{y}.png',
	{		
		tileSize: 256,
		minZoom: 0,
		maxZoom: pano_maxZoom+5,
		maxNativeZoom: pano_maxZoom,
		continuousWorld: true,
		noWrap: true,
		attributionControl: false,
		//attribution: 'Scan Name: ',
		attribution: '???PointCab_mapName???',
		//id: 'mapbox.scan'
	}).addTo(map);
		
	var southWest = map.unproject([0, 0], pano_maxZoom); //map.getMaxZoom());
	var northEast = map.unproject([pano_cols, pano_rows], pano_maxZoom); //map.getMaxZoom());
	map.setMaxBounds(new L.LatLngBounds(southWest, northEast));
	
	// do zoom fit by my own
	map.setView([pano_rows/2, pano_cols/2], window.innerWidth/256);
	
	L.control.mousePosition(
	{
		position: 'topright',
		lngFirst: true,
		numDigits: 4,
		emptystring: "Coordinate",
		prefix: "uv: "
	}).addTo(map);
	
	// force the div element to be able to resize to height 100%
	$(window).on("resize", function() {
		$("#panomap").height($(window).height()).width($(window).width());
		map.invalidateSize();
	}).trigger("resize");

}
</script>
	
<body onload="initialize()">
	<div id="panomap" class="smallmap"></div>	
</body>
</html>
